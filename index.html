<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generative Sound Bath</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #f5f0e8;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    #app {
      position: fixed;
      top: 0;
      left: 0;
    }
    #start-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(245, 240, 232, 0.97);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      cursor: pointer;
      overflow: hidden;
    }
    #start-overlay h1 {
      color: #3a3632;
      font-family: Georgia, 'Times New Roman', serif;
      font-weight: 400;
      font-size: 1.8rem;
      letter-spacing: 0.15em;
      transition: transform 0.6s ease-out;
      z-index: 2;
      position: relative;
    }
    #wave-container {
      position: absolute;
      width: 120%;
      height: 200px;
      left: -10%;
      top: calc(50% + -21px);
      transition: transform 0.6s ease-out;
      z-index: 3;
    }
    #wave-canvas {
      width: 100%;
      height: 100%;
    }
    #submerge-control {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      font-family: Georgia, 'Times New Roman', serif;
      font-size: 0.75rem;
      color: #5a554d;
    }
    #submerge-control label {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #submerge-control input[type="range"] {
      width: 120px;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 2px;
      outline: none;
    }
    #submerge-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #3a3632;
      border-radius: 50%;
      cursor: pointer;
    }

    /* Settings gear button */
    #settings-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(4px);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 101;
      display: none;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, transform 0.2s;
    }
    #settings-btn:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: scale(1.05);
    }
    #settings-btn.active {
      background: rgba(255, 255, 255, 0.5);
    }
    #settings-btn svg {
      width: 22px;
      height: 22px;
      fill: #5a554d;
    }

    /* Admin panel */
    #admin-panel {
      position: fixed;
      top: 74px;
      right: 20px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(4px);
      border-radius: 12px;
      padding: 16px 20px;
      font-family: Georgia, 'Times New Roman', serif;
      font-size: 0.8rem;
      color: #5a554d;
      z-index: 100;
      min-width: 180px;
      display: none;
      max-height: calc(100vh - 180px);
      overflow-y: auto;
    }
    #admin-panel.visible {
      display: block;
    }
    #admin-panel h2 {
      font-size: 0.7rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin: 0 0 12px 0;
      color: #7a756d;
    }
    #admin-panel .control {
      margin-bottom: 12px;
    }
    #admin-panel .control:last-child {
      margin-bottom: 0;
    }
    #admin-panel label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.75rem;
    }
    #admin-panel input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 2px;
      outline: none;
    }
    #admin-panel input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: #8b7355;
      border-radius: 50%;
      cursor: pointer;
    }
    #admin-panel input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: #8b7355;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    #admin-panel .value {
      font-size: 0.7rem;
      color: #9a958d;
      float: right;
    }
    #admin-panel select {
      width: 100%;
      padding: 4px 6px;
      font-family: Georgia, 'Times New Roman', serif;
      font-size: 0.75rem;
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 4px;
      background: rgba(255,255,255,0.5);
      color: #5a554d;
      cursor: pointer;
      margin-top: 4px;
    }
    #admin-panel .perf {
      font-size: 0.65rem;
      color: #9a958d;
      font-family: monospace;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(0,0,0,0.08);
    }

    /* Play bar */
    #play-bar {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(4px);
      border-radius: 28px;
      padding: 12px 24px;
      display: none;
      align-items: center;
      gap: 16px;
      z-index: 100;
      font-family: Georgia, 'Times New Roman', serif;
    }
    #play-bar.visible {
      display: flex;
    }
    #mute-btn {
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.3);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, transform 0.1s;
    }
    #mute-btn:hover {
      background: rgba(255, 255, 255, 0.5);
    }
    #mute-btn:active {
      transform: scale(0.95);
    }
    #mute-btn svg {
      width: 24px;
      height: 24px;
      fill: #5a554d;
    }
    #mute-btn.muted svg.unmuted,
    #mute-btn:not(.muted) svg.muted {
      display: none;
    }
    #playbar-volume {
      width: 100px;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 2px;
      outline: none;
    }
    #playbar-volume::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #8b7355;
      border-radius: 50%;
      cursor: pointer;
    }
    #playbar-volume::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #8b7355;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Settings gear button -->
  <button id="settings-btn" aria-label="Settings">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
    </svg>
  </button>

  <!-- Admin panel (hidden by default) -->
  <div id="admin-panel">
    <h2>controls</h2>
    <div class="control">
      <label>circles <span class="value" id="circles-val">9</span></label>
      <input type="range" id="circles-slider" min="2" max="200" value="9">
    </div>
    <div class="control">
      <label>scale</label>
      <select id="scale-select">
        <option value="pentatonic-d">D Major Pentatonic</option>
        <option value="pentatonic-a-minor">A Minor Pentatonic</option>
        <option value="whole-tone">Whole Tone</option>
        <option value="dorian">D Dorian</option>
        <option value="miyako-bushi">Japanese (In Sen)</option>
      </select>
    </div>
    <div class="control">
      <label>theme</label>
      <select id="theme-select">
        <option value="warm">Warm Sand</option>
        <option value="aquatic">Aquatic</option>
        <option value="dark">Midnight</option>
        <option value="blossom">Blossom</option>
      </select>
    </div>
    <div class="control">
      <label>volume <span class="value" id="volume-val">70%</span></label>
      <input type="range" id="volume-slider" min="0" max="100" value="70">
    </div>
    <div class="control">
      <label>room size <span class="value" id="room-val">50%</span></label>
      <input type="range" id="room-slider" min="0" max="100" value="50">
    </div>
    <div class="control">
      <label>velocity <span class="value" id="velocity-val">0.20</span></label>
      <input type="range" id="velocity-slider" min="5" max="400" value="20">
    </div>
    <div class="control">
      <label>radius mult <span class="value" id="radius-val">1.50</span></label>
      <input type="range" id="radius-slider" min="50" max="200" value="150">
    </div>
    <div class="control">
      <label>ripple expand <span class="value" id="ripple-expand-val">0.9</span></label>
      <input type="range" id="ripple-expand-slider" min="1" max="100" value="9">
    </div>
    <div class="control">
      <label>ripple fade <span class="value" id="ripple-fade-val">0.1</span></label>
      <input type="range" id="ripple-fade-slider" min="1" max="50" value="1">
    </div>
    <div class="control">
      <label>dust count <span class="value" id="dust-count-val">50</span></label>
      <input type="range" id="dust-count-slider" min="0" max="500" value="50">
    </div>
    <div class="control">
      <label>dust velocity <span class="value" id="dust-vel-val">0.20</span></label>
      <input type="range" id="dust-vel-slider" min="0" max="100" value="20">
    </div>
    <div class="control">
      <label>dust power <span class="value" id="dust-power-val">0.0140</span></label>
      <input type="range" id="dust-power-slider" min="1" max="500" value="140">
    </div>
    <div class="control">
      <label>dust range <span class="value" id="dust-range-val">75</span></label>
      <input type="range" id="dust-range-slider" min="1" max="100" value="75">
    </div>
    <div class="control">
      <label>dust buffer <span class="value" id="dust-buffer-val">15</span></label>
      <input type="range" id="dust-buffer-slider" min="0" max="30" value="15">
    </div>
    <div class="control">
      <label>dust decay <span class="value" id="dust-decay-val">0.95</span></label>
      <input type="range" id="dust-decay-slider" min="80" max="99" value="95">
    </div>
    <div class="control">
      <label>field strength <span class="value" id="field-strength-val">0.0008</span></label>
      <input type="range" id="field-strength-slider" min="1" max="100" value="8">
    </div>
    <div class="control">
      <label>field scale <span class="value" id="field-scale-val">0.005</span></label>
      <input type="range" id="field-scale-slider" min="1" max="50" value="5">
    </div>
    <div class="control perf">
      <span id="fps-display">-- fps</span>
    </div>
  </div>

  <!-- Play bar -->
  <div id="play-bar">
    <button id="mute-btn" aria-label="Mute">
      <svg class="unmuted" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
      </svg>
      <svg class="muted" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
      </svg>
    </button>
    <input type="range" id="playbar-volume" min="0" max="100" value="70" aria-label="Volume">
  </div>

  <div id="start-overlay">
    <h1>enter bath â†’</h1>
    <div id="wave-container">
      <canvas id="wave-canvas"></canvas>
    </div>
    <div id="submerge-control">
      <label>submerge: <span id="submerge-val">6</span></label>
      <input type="range" id="submerge-slider" min="1" max="150" value="6">
      <label>wave Y: <span id="wave-y-val">-21</span></label>
      <input type="range" id="wave-y-slider" min="-50" max="150" value="-21">
    </div>
  </div>

  <script>
    // Wave animation for start overlay
    (function() {
      const canvas = document.getElementById('wave-canvas');
      const ctx = canvas.getContext('2d');
      const overlay = document.getElementById('start-overlay');
      const title = overlay.querySelector('h1');
      const waveContainer = document.getElementById('wave-container');
      const submergeSlider = document.getElementById('submerge-slider');
      const submergeVal = document.getElementById('submerge-val');
      const waveYSlider = document.getElementById('wave-y-slider');
      const waveYVal = document.getElementById('wave-y-val');

      let animationId;
      let time = 0;
      let submergeAmount = 6;
      let waveYOffset = -21;

      submergeSlider.addEventListener('input', (e) => {
        submergeAmount = parseInt(e.target.value);
        submergeVal.textContent = submergeAmount;
      });

      waveYSlider.addEventListener('input', (e) => {
        waveYOffset = parseInt(e.target.value);
        waveYVal.textContent = waveYOffset;
        waveContainer.style.top = `calc(50% + ${waveYOffset}px)`;
      });

      // Prevent slider clicks from triggering the start
      submergeSlider.addEventListener('click', (e) => e.stopPropagation());
      waveYSlider.addEventListener('click', (e) => e.stopPropagation());

      function resize() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
      }

      function drawWave() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#f5f0e8';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height);

        const amplitude = 6;
        const frequency = 0.02;
        const speed = 0.008;

        for (let x = 0; x <= canvas.width; x++) {
          const y = Math.sin(x * frequency + time * speed) * amplitude + 40;
          ctx.lineTo(x, y);
        }

        ctx.lineTo(canvas.width, canvas.height);
        ctx.closePath();
        ctx.fill();
      }

      function animate() {
        time++;
        drawWave();
        animationId = requestAnimationFrame(animate);
      }

      // Detect mouse proximity to title
      overlay.addEventListener('mousemove', (e) => {
        const rect = title.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const distance = Math.sqrt(
          Math.pow(e.clientX - centerX, 2) +
          Math.pow(e.clientY - centerY, 2)
        );

        if (distance < 150) {
          overlay.classList.add('submerged');
          title.style.transform = `translateY(${submergeAmount}px)`;
          waveContainer.style.transform = `translateY(${-submergeAmount * 1.3}px)`;
        } else {
          overlay.classList.remove('submerged');
          title.style.transform = 'translateY(0)';
          waveContainer.style.transform = 'translateY(0)';
        }
      });

      overlay.addEventListener('mouseleave', () => {
        overlay.classList.remove('submerged');
        title.style.transform = 'translateY(0)';
        waveContainer.style.transform = 'translateY(0)';
      });

      // Stop animation when overlay is hidden
      const observer = new MutationObserver(() => {
        if (overlay.style.display === 'none') {
          cancelAnimationFrame(animationId);
        }
      });
      observer.observe(overlay, { attributes: true, attributeFilter: ['style'] });

      resize();
      window.addEventListener('resize', resize);
      animate();
    })();
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
